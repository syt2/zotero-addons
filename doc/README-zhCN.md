# Zotero Plugin Template

[![zotero target version](https://img.shields.io/badge/Zotero-7-green?style=flat-square&logo=zotero&logoColor=CC2936)](https://www.zotero.org)
[![Using Zotero Plugin Template](https://img.shields.io/badge/Using-Zotero%20Plugin%20Template-blue?style=flat-square&logo=github)](https://github.com/windingwind/zotero-plugin-template)

è¿™æ˜¯ [Zotero](https://www.zotero.org/) çš„æ’ä»¶æ¨¡æ¿.

[English](../README.md) | [ç®€ä½“ä¸­æ–‡](./README-zhCN.md)

ä½¿ç”¨æ­¤æ¨¡æ¿åˆ›å»ºçš„ä¸€äº›æ’ä»¶:

[![GitHub Repo stars](https://img.shields.io/github/stars/windingwind/zotero-better-notes?label=zotero-better-notes&style=flat-square)](https://github.com/windingwind/zotero-better-notes)
[![GitHub Repo stars](https://img.shields.io/github/stars/windingwind/zotero-pdf-preview?label=zotero-pdf-preview&style=flat-square)](https://github.com/windingwind/zotero-pdf-preview)
[![GitHub Repo stars](https://img.shields.io/github/stars/windingwind/zotero-pdf-translate?label=zotero-pdf-translate&style=flat-square)](https://github.com/windingwind/zotero-pdf-translate)
[![GitHub Repo stars](https://img.shields.io/github/stars/windingwind/zotero-tag?label=zotero-tag&style=flat-square)](https://github.com/windingwind/zotero-tag)
[![GitHub Repo stars](https://img.shields.io/github/stars/iShareStuff/ZoteroTheme?label=zotero-theme&style=flat-square)](https://github.com/iShareStuff/ZoteroTheme)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/zotero-reference?label=zotero-reference&style=flat-square)](https://github.com/MuiseDestiny/zotero-reference)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/zotero-citation?label=zotero-citation&style=flat-square)](https://github.com/MuiseDestiny/zotero-citation)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/ZoteroStyle?label=zotero-style&style=flat-square)](https://github.com/MuiseDestiny/ZoteroStyle)
[![GitHub Repo stars](https://img.shields.io/github/stars/volatile-static/Chartero?label=Chartero&style=flat-square)](https://github.com/volatile-static/Chartero)
[![GitHub Repo stars](https://img.shields.io/github/stars/l0o0/tara?label=tara&style=flat-square)](https://github.com/l0o0/tara)
[![GitHub Repo stars](https://img.shields.io/github/stars/redleafnew/delitemwithatt?label=delitemwithatt&style=flat-square)](https://github.com/redleafnew/delitemwithatt)
[![GitHub Repo stars](https://img.shields.io/github/stars/redleafnew/zotero-updateifsE?label=zotero-updateifsE&style=flat-square)](https://github.com/redleafnew/zotero-updateifsE)
[![GitHub Repo stars](https://img.shields.io/github/stars/northword/zotero-format-metadata?label=zotero-format-metadata&style=flat-square)](https://github.com/northword/zotero-format-metadata)
[![GitHub Repo stars](https://img.shields.io/github/stars/inciteful-xyz/inciteful-zotero-plugin?label=inciteful-zotero-plugin&style=flat-square)](https://github.com/inciteful-xyz/inciteful-zotero-plugin)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/zotero-gpt?label=zotero-gpt&style=flat-square)](https://github.com/MuiseDestiny/zotero-gpt)
[![GitHub Repo stars](https://img.shields.io/github/stars/zoushucai/zotero-journalabbr?label=zotero-journalabbr&style=flat-square)](https://github.com/zoushucai/zotero-journalabbr)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/zotero-figure?label=zotero-figure&style=flat-square)](https://github.com/MuiseDestiny/zotero-figure)
[![GitHub Repo stars](https://img.shields.io/github/stars/MuiseDestiny/zotero-file?label=WanderingFile&style=flat-square)](https://github.com/MuiseDestiny/zotero-file)
[![GitHub Repo stars](https://img.shields.io/github/stars/l0o0/jasminum?label=jasminum&style=flat-square)](https://github.com/l0o0/jasminum)
[![GitHub Repo stars](https://img.shields.io/github/stars/lifan0127/ai-research-assistant?label=ai-research-assistant&style=flat-square)](https://github.com/lifan0127/ai-research-assistant)

ğŸ“– [æ’ä»¶å¼€å‘æ–‡æ¡£](https://zotero.yuque.com/books/share/8d230829-6004-4934-b4c6-685a7001bfa0/vec88d) (ä¸­æ–‡ç‰ˆ)

ğŸ› ï¸ [Zotero æ’ä»¶å·¥å…·åŒ…](https://github.com/windingwind/zotero-plugin-toolkit) | [API æ–‡æ¡£](https://github.com/windingwind/zotero-plugin-toolkit/blob/master/docs/zotero-plugin-toolkit.md)

â„¹ï¸ [Zotero ç±»å‹å®šä¹‰](https://github.com/windingwind/zotero-types)

ğŸ“œ [Zotero æºä»£ç ](https://github.com/zotero/zotero)

ğŸ“Œ [Zotero æ’ä»¶æ¨¡æ¿](https://github.com/windingwind/zotero-plugin-template) (å³å½“å‰åº“)

> ğŸ‘ å…³æ³¨æ­¤åº“ï¼Œä»¥ä¾¿åœ¨æœ‰ä¿®å¤æˆ–æ›´æ–°æ—¶åŠæ—¶æ”¶åˆ°é€šçŸ¥.

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨æ­¤åº“ï¼Œæˆ‘å»ºè®®ä½ å°†è¿™ä¸ªæ ‡å¿— ([![Using Zotero Plugin Template](https://img.shields.io/badge/Using-Zotero%20Plugin%20Template-blue?style=flat-square&logo=github)](https://github.com/windingwind/zotero-plugin-template)) æ”¾åœ¨ README æ–‡ä»¶ä¸­:

```md
[![Using Zotero Plugin Template](https://img.shields.io/badge/Using-Zotero%20Plugin%20Template-blue?style=flat-square&logo=github)](https://github.com/windingwind/zotero-plugin-template)
```

## Features ç‰¹æ€§

> â—Zoteroç³»ç»Ÿå·²å‡çº§(dtd å·²å¼ƒç”¨ï¼Œæˆ‘ä»¬å°†ä¸åœ¨ä½¿ç”¨ .properties). ä¸»åˆ†æ”¯å°†åªæ”¯æŒ Zotero 7.0.0-beta.12 æˆ–æ›´é«˜ç‰ˆæœ¬. å¦‚æœéœ€è¦æ”¯æŒ Zotero 6ï¼Œå¯èƒ½éœ€è¦åŒæ—¶ä½¿ç”¨`dtd`ã€`properties` å’Œ`ftl`. è¯·å‚è€ƒæ­¤åº“çš„ `zotero6-bootstrap` åˆ†æ”¯.

- äº‹ä»¶é©±åŠ¨ã€å‡½æ•°å¼ç¼–ç¨‹çš„å¯æ‰©å±•æ¡†æ¶ï¼›
- ç®€å•æ˜“ç”¨ï¼Œå¼€ç®±å³ç”¨ï¼›
- â­[æ–°ç‰¹æ€§!]è‡ªåŠ¨çƒ­é‡è½½ï¼æ¯å½“ä¿®æ”¹æºç æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨ç¼–è¯‘å¹¶é‡æ–°åŠ è½½æ’ä»¶ï¼›[è¯¦æƒ…è¯·è·³è½¬â†’](#auto-hot-reload)
- `src/modules/examples.ts` ä¸­æœ‰ä¸°å¯Œçš„ç¤ºä¾‹ï¼Œæ¶µç›–äº†æ’ä»¶ä¸­å¸¸ç”¨çš„å¤§éƒ¨åˆ†API(ä½¿ç”¨çš„æ’ä»¶å·¥å…·åŒ… [zotero-plugin-toolkit](https://github.com/windingwind/zotero-plugin-toolkit))ï¼›
- TypeScript æ”¯æŒ:
  - ä¸ºä½¿ç”¨ JavaScript ç¼–å†™çš„Zoteroæºç æä¾›å…¨é¢çš„ç±»å‹å®šä¹‰æ”¯æŒ(ä½¿ç”¨ç±»å‹å®šä¹‰åŒ…[zotero-types](https://github.com/windingwind/zotero-types))ï¼›
  - å…¨å±€å˜é‡å’Œç¯å¢ƒè®¾ç½®ï¼›
- æ’ä»¶æ„å»º/æµ‹è¯•/å‘å¸ƒå·¥ä½œæµ:
  - è‡ªåŠ¨ç”Ÿæˆ/æ›´æ–°æ’ä»¶idå’Œç‰ˆæœ¬ã€æ›´æ–°é…ç½®å’Œè®¾ç½®ç¯å¢ƒå˜é‡ (`development/production`)ï¼›
  - è‡ªåŠ¨åœ¨ Zotero ä¸­æ„å»ºå’Œé‡æ–°åŠ è½½ä»£ç ï¼›
  - è‡ªåŠ¨å‘å¸ƒåˆ°GitHub (ä½¿ç”¨[release-it](https://github.com/release-it/release-it));

## Examples ç¤ºä¾‹

æ­¤åº“æä¾›äº† [zotero-plugin-toolkit](https://github.com/windingwind/zotero-plugin-toolkit) ä¸­APIçš„ç¤ºä¾‹.

åœ¨ `src/examples.ts` ä¸­æœç´¢`@example` æŸ¥çœ‹ç¤ºä¾‹. è¿™äº›ç¤ºä¾‹åœ¨ `src/hooks.ts` ä¸­è°ƒç”¨æ¼”ç¤º.

### åŸºæœ¬ç¤ºä¾‹(Basic Examples)

- registerNotifier
- registerPrefs, unregisterPrefs

### å¿«æ·é”®ç¤ºä¾‹(Shortcut Keys Examples)

- registerShortcuts
- exampleShortcutLargerCallback
- exampleShortcutSmallerCallback
- exampleShortcutConflictionCallback

### UIç¤ºä¾‹(UI Examples)

![image](https://user-images.githubusercontent.com/33902321/211739774-cc5c2df8-5fd9-42f0-9cdf-0f2e5946d427.png)

- registerStyleSheet(the official make-it-red example)
- registerRightClickMenuItem
- registerRightClickMenuPopup
- registerWindowMenuWithSeprator
- registerExtraColumn
- registerExtraColumnWithCustomCell
- registerCustomItemBoxRow
- registerLibraryTabPanel
- registerReaderTabPanel

### é¦–é€‰é¡¹é¢æ¿ç¤ºä¾‹(Preference Pane Examples)

![image](https://user-images.githubusercontent.com/33902321/211737987-cd7c5c87-9177-4159-b975-dc67690d0490.png)

- Preferences bindings
- UI Events
- Tabel
- Locale

è¯¦æƒ…å‚è§ [`src/modules/preferenceScript.ts`](./src/modules/preferenceScript.ts)

### å¸®åŠ©ç¤ºä¾‹(HelperExamples)

![image](https://user-images.githubusercontent.com/33902321/215119473-e7d0d0ef-6d96-437e-b989-4805ffcde6cf.png)

- dialogExample
- clipboardExample
- filePickerExample
- progressWindowExample
- vtableExample(See Preference Pane Examples)

### æŒ‡ä»¤è¡Œç¤ºä¾‹(PromptExamples)

Obsidiané£æ ¼çš„æŒ‡ä»¤è¾“å…¥æ¨¡å—ï¼Œå®ƒé€šè¿‡æ¥å—æ–‡æœ¬æ¥è¿è¡Œæ’ä»¶ï¼Œå¹¶åœ¨å¼¹å‡ºçª—å£ä¸­æ˜¾ç¤ºå¯é€‰é¡¹.

ä½¿ç”¨ `Shift+P` æ¿€æ´».

![image](https://user-images.githubusercontent.com/33902321/215120009-e7c7ed27-33a0-44fe-b021-06c272481a92.png)

- registerAlertPromptExample

## Quick Start Guide å¿«é€Ÿå…¥é—¨æŒ‡å—

### å®‰è£…é¢„æ„å»º `xpi`

é€šè¿‡ç›´æ¥åœ¨GitHubä¸­ä¸‹è½½æ„å»ºå¥½çš„ `xpi` æ–‡ä»¶å¹¶å°†å…¶å®‰è£…åˆ°Zoteroä¸­æ¥äº†è§£ç¤ºä¾‹çš„å·¥ä½œåŸç†.

è¿™ä¹Ÿæ˜¯ä½ å‘å¸ƒæ’ä»¶çš„æ ¼å¼ï¼ŒåŒæ—¶è¿™ä¹Ÿå°†æ˜¯å…¶ä»–äººå¯ä»¥ç›´æ¥ä½¿ç”¨çš„ç‰ˆæœ¬.

> è¯¥åº“æ„å»ºå¥½çš„xpiæ–‡ä»¶ä¸å…·æœ‰ä»»ä½•å®é™…åŠŸèƒ½ï¼Œå®ƒå¯èƒ½ä¸éšZoteroæ›´æ–°è€Œéšæ—¶æ›´æ–°.
>
> `xpi` æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªzipå‹ç¼©åŒ…ï¼Œç„¶è€Œï¼Œè¯·ä¸è¦ç›´æ¥ä¿®æ”¹å®ƒï¼Œè€Œæ˜¯ä¿®æ”¹æºä»£ç å¹¶é‡æ–°æ„å»ºå®ƒ.

### ä»æºç æ„å»º(Build from Source)

- Fork æ­¤åº“æˆ–è€…ä½¿ç”¨ `Use this template`ï¼›
- ä½¿ç”¨ `git clone ` å…‹éš†æ­¤åº“ï¼›
- è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼›
<details >
<summary>ğŸ’¡ ä» GitHub Codespace å¼€å§‹</summary>

_GitHub CodeSpace_ ä½¿ä½ å¯ä»¥ç›´æ¥å¼€å§‹å¼€å‘è€Œæ— éœ€åœ¨æœ¬åœ°ä¸‹è½½ä»£ç /IDE/ä¾èµ–.

é‡å¤ä¸‹åˆ—æ­¥éª¤ï¼Œä»…éœ€ä¸‰åç§’å³å¯å¼€å§‹æ„å»ºä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶ï¼

- å» [homepage](https://github.com/windingwind/zotero-plugin-template)é¡¶éƒ¨ï¼Œç‚¹å‡»ç»¿è‰²æŒ‰é’®`Use this template`ï¼Œç‚¹å‡» `Open in codespace`ï¼Œ ä½ éœ€è¦ç™»å½•ä½ çš„GitHubè´¦å·.
- ç­‰å¾… codespace åŠ è½½.
- ä¿®æ”¹ `./package.json` ä¸­çš„è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼š
  </details>

  ```json5
  {
    version,
    author,
    description,
    homepage,
    config {
      releasepage, // URL to releases(`.xpi`)
      updaterdf, // URL to update.json
      addonName, // name to be displayed in the plugin manager
      addonID, // ID to avoid conflict. IMPORTANT!
      addonRef, // e.g. Element ID prefix
      addonInstance // the plugin's root instance: Zotero.${addonInstance}
    }
  }
  ```

  > æ³¨æ„è®¾ç½® addonID å’Œ addonRef ä»¥é¿å…å†²çª.

- è¿è¡Œ `npm install` ä»¥è®¾ç½®æ’ä»¶å¹¶å®‰è£…ç›¸å…³ä¾èµ–. å¦‚æœä½ æ²¡æœ‰å®‰è£… Node.jsï¼Œè¯·åœ¨[æ­¤å¤„ä¸‹è½½](https://nodejs.org/en/);
- è¿è¡Œ `npm run build` ä»¥åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹æ„å»ºæ’ä»¶ï¼Œè¿è¡Œ `npm run build-dev` ä»¥åœ¨å¼€å‘æ¨¡å¼ä¸‹æ„å»ºæ’ä»¶. ç”¨äºå®‰è£…çš„ xpi æ–‡ä»¶å’Œç”¨äºæ„å»ºçš„ä»£ç åœ¨ `build` æ–‡ä»¶å¤¹ä¸‹.

  > Dev & prod ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«?
  >
  > - æ­¤ç¯å¢ƒå˜é‡å­˜å‚¨åœ¨ `Zotero.${addonInstance}.data.env` ä¸­ï¼Œæ§åˆ¶å°è¾“å‡ºåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹è¢«ç¦ç”¨.
  > - ä½ å¯ä»¥æ ¹æ®æ­¤å˜é‡å†³å®šç”¨æˆ·æ— æ³•æŸ¥çœ‹/ä½¿ç”¨çš„å†…å®¹.

### å‘å¸ƒ(Release)

å¦‚æœè¦æ„å»ºå’Œå‘å¸ƒæ’ä»¶ï¼Œè¿è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š

```shell
# A release-it command: version increase, npm run build, git push, and GitHub release
# You need to set the environment variable GITHUB_TOKEN https://github.com/settings/tokens
# release-it: https://github.com/release-it/release-it
npm run release
```

### è®¾ç½®å¼€å‘ç¯å¢ƒ(Setup Development Environment)

1. å®‰è£… Zotero: <https://www.zotero.org/support/beta_builds> (Zotero 7 beta: <https://www.zotero.org/support/dev/zotero_7_for_developers>)

2. å®‰è£… Firefox 102 (é€‚ç”¨äº Zotero 7)

3. å¤åˆ¶ zotero å‘½ä»¤è¡Œé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å¼€å§‹å®‰è£… beta Zotero çš„å‘½ä»¤.

   > (å¯é€‰é¡¹) æ­¤æ“ä½œä»…éœ€æ‰§è¡Œä¸€æ¬¡: ä½¿ç”¨ `/path/to/zotero -p` å¯åŠ¨ Zoteroï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶å¹¶ç”¨ä½œå¼€å‘é…ç½®æ–‡ä»¶.
   > å°†é…ç½®æ–‡ä»¶çš„è·¯å¾„ `profilePath` æ”¾å…¥ `zotero-cmd.json` ä¸­ï¼Œä»¥æŒ‡å®šè¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶.

   ```sh
   cp ./scripts/zotero-cmd-default.json ./scripts/zotero-cmd.json
   vim ./scripts/zotero-cmd.json
   ```

4. æ„å»ºæ’ä»¶å¹¶ä½¿ç”¨ `npm run restart` é‡å¯ Zotero.

5. å¯åŠ¨ Firefox 102 (Zotero 7)

6. åœ¨ Firefox ä¸­ï¼Œè½¬åˆ°devtoolsï¼Œè½¬åˆ°è®¾ç½®ï¼Œå•å‡» "enable remote debugging" ï¼ŒåŒæ—¶ï¼Œæ—è¾¹çš„æŒ‰é’®ä¹Ÿæ˜¯å…³äºè°ƒè¯•çš„ã€‚

   > åœ¨ FirFox 102 ä¸­è¾“å…¥ `about:debugging#/setup` .

7. åœ¨ Zotero ä¸­ï¼Œè¿›å…¥è®¾ç½®-é«˜çº§-ç¼–è¾‘å™¨ï¼Œæœç´¢ "debugging" ç„¶åå•å‡» "allow remote debugging".

8. åœ¨ Firefox ä¸­è¿æ¥ Zotero. åœ¨ FireFox 102ä¸­ï¼Œåœ¨è¿œç¨‹è°ƒè¯•é¡µé¢åº•éƒ¨è¾“å…¥ `localhost:6100` ç„¶åå•å‡» `add`.

9. åœ¨è¿œç¨‹è°ƒè¯•é¡µé¢å·¦ä¾§æ ç‚¹å‡» `connect`.

10. ç‚¹å‡» "Inspect Main Process"

### è‡ªåŠ¨çƒ­é‡è½½(Auto Hot Reload)

åŒå€¦äº†æ— ä¼‘æ­¢çš„é‡å¯å—ï¼Ÿå¿˜æ‰å®ƒï¼Œæ‹¥æŠ±çƒ­åŠ è½½ï¼

1. è¿è¡Œ `npm run start-watch`. (å¦‚æœZoteroå·²ç»åœ¨è¿è¡Œï¼Œè¯·ä½¿ç”¨ `npm run watch`)
2. ç¼–ç . (æ˜¯çš„ï¼Œå°±è¿™ä¹ˆç®€å•)

å½“æ£€æµ‹åˆ° `src` æˆ– `addon` ä¸­çš„æ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œæ’ä»¶å°†è‡ªåŠ¨ç¼–è¯‘å¹¶é‡æ–°åŠ è½½.

<details style="text-indent: 2em">
<summary>ğŸ’¡ å°†æ­¤åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰æ’ä»¶çš„æ­¥éª¤</summary>

1. å¤åˆ¶ `scripts/reload.mjs`
2. å¤åˆ¶ `reload` ã€`watch` å’Œ `start-watch` å‘½ä»¤ `package.json`
3. è¿è¡Œ `npm install --save-dev chokidar-cli`
4. ç»“æŸ.

</details>

### åœ¨ Zotero ä¸­è°ƒè¯•

ä½ è¿˜å¯ä»¥:

- åœ¨ Tools->Developer->Run Javascript ä¸­æµ‹è¯•ä»£ç ç‰‡æ®µ;
- ä½¿ç”¨ `Zotero.debug()` è°ƒè¯•è¾“å‡º. åœ¨ Help->Debug Output Logging->View Output æŸ¥çœ‹è¾“å‡º;
- è°ƒè¯• UI. Zotero å»ºç«‹åœ¨ Firefox XUL æ¡†æ¶ä¹‹ä¸Š. ä½¿ç”¨ [XUL Explorer](https://udn.realityripple.com/docs/Archive/Mozilla/XUL_Explorer) ç­‰è½¯ä»¶è°ƒè¯• XUL UI.
  > XUL æ–‡æ¡£: <http://www.devdoc.net/web/developer.mozilla.org/en-US/docs/XUL.html>

## Details æ›´å¤šç»†èŠ‚

### å…³äºHooks(About Hooks)

> å¯ä»¥åœ¨ [`src/hooks.ts`](https://github.com/windingwind/zotero-plugin-template/blob/bootstrap/src/hooks.ts) ä¸­æŸ¥çœ‹æ›´å¤š

1. å½“åœ¨ Zotero ä¸­è§¦å‘å®‰è£…/å¯ç”¨/å¯åŠ¨æ—¶ï¼Œ`bootstrap.js` > `startup` è¢«è°ƒç”¨
   - ç­‰å¾… Zotero å°±ç»ª
   - åŠ è½½ `index.js` (æ’ä»¶ä»£ç çš„ä¸»å…¥å£ï¼Œä» `index.ts` ä¸­æ„å»º)
   - å¦‚æœæ˜¯ Zotero 7 ä»¥ä¸Šçš„ç‰ˆæœ¬åˆ™æ³¨å†Œèµ„æº
2. ä¸»å…¥å£ `index.js` ä¸­ï¼Œæ’ä»¶å¯¹è±¡è¢«æ³¨å…¥åˆ° `Zotero` ï¼Œå¹¶ä¸” `hooks.ts` > `onStartup` è¢«è°ƒç”¨.
   - åˆå§‹åŒ–æ’ä»¶éœ€è¦çš„èµ„æºï¼ŒåŒ…æ‹¬é€šçŸ¥ç›‘å¬å™¨ã€é¦–é€‰é¡¹é¢æ¿å’ŒUIå…ƒç´ .
3. å½“åœ¨ Zotero ä¸­è§¦å‘å¸è½½/ç¦ç”¨æ—¶ï¼Œ`bootstrap.js` > `shutdown` è¢«è°ƒç”¨.
   - `events.ts` > `onShutdown` è¢«è°ƒç”¨. ç§»é™¤ UI å…ƒç´ ã€é¦–é€‰é¡¹é¢æ¿æˆ–æ’ä»¶åˆ›å»ºçš„ä»»ä½•å†…å®¹.
   - ç§»é™¤è„šæœ¬å¹¶é‡Šæ”¾èµ„æº.

### å…³äºå…¨å±€å˜é‡(About Global Variables)

> å¯ä»¥åœ¨ [`src/index.ts`](https://github.com/windingwind/zotero-plugin-template/blob/bootstrap/src/index.ts) ä¸­æŸ¥çœ‹æ›´å¤š

å¼•å¯¼æ’ä»¶åœ¨æ²™ç›’ä¸­è¿è¡Œï¼Œä½†æ²™ç›’ä¸­æ²¡æœ‰é»˜è®¤çš„å…¨å±€å˜é‡ï¼Œä¾‹å¦‚ `Zotero` æˆ– `window` ç­‰æˆ‘ä»¬æ›¾åœ¨è¦†ç›–æ’ä»¶ç¯å¢ƒä¸­ä½¿ç”¨çš„å˜é‡.

æ­¤æ¨¡æ¿å°†ä»¥ä¸‹å˜é‡æ³¨å†Œåˆ°å…¨å±€èŒƒå›´:

```ts
Zotero, ZoteroPane, Zotero_Tabs, window, document, rootURI, ztoolkit, addon;
```

### åˆ›å»ºå…ƒç´  API(Create Elements API)

æ’ä»¶æ¨¡æ¿ä¸º bootstrap æ’ä»¶æä¾›äº†ä¸€äº›æ–°çš„API. æˆ‘ä»¬æœ‰ä¸¤ä¸ªåŸå› ä½¿ç”¨è¿™äº› APIï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `createElement/createElementNS`ï¼š

- åœ¨ bootstrap æ¨¡å¼ä¸‹ï¼Œæ’ä»¶å¿…é¡»åœ¨æ¨å‡ºï¼ˆç¦ç”¨æˆ–å¸è½½ï¼‰æ—¶æ¸…ç†æ‰€æœ‰ UI å…ƒç´ ï¼Œè¿™éå¸¸éº»çƒ¦. ä½¿ç”¨ `createElement`ï¼Œæ’ä»¶æ¨¡æ¿å°†ç»´æŠ¤è¿™äº›å…ƒç´ . ä»…ä»…åœ¨é€€å‡ºæ—¶ `unregisterAll` .
- Zotero 7 éœ€è¦ createElement()/createElementNS() â†’ createXULElement() æ¥è¡¨ç¤ºå…¶ä»–çš„ XUL å…ƒç´ ï¼Œè€Œ Zotero 6 å¹¶ä¸æ”¯æŒ `createXULElement`. ç±»ä¼¼äº React.createElement çš„API `createElement` æ£€æµ‹ namespace(xul/html/svg) å¹¶ä¸”è‡ªåŠ¨åˆ›å»ºå…ƒç´ ï¼Œè¿”å›å…ƒç´ ä¸ºå¯¹åº”çš„ TypeScript å…ƒç´ ç±»å‹.

```ts
createElement(document, "div"); // returns HTMLDivElement
createElement(document, "hbox"); // returns XUL.Box
createElement(document, "button", { namespace: "xul" }); // manually set namespace. returns XUL.Button
```

### å…³äºæ„å»º(About Build)

ä½¿ç”¨ Esbuild å°† `.ts` æºä»£ç æ„å»ºä¸º `.js`.

ä½¿ç”¨ `replace-in-file` å»æ›¿æ¢åœ¨ `package.json` ä¸­å®šä¹‰çš„å…³é”®å­—å’Œé…ç½® (`xhtml`ã€`.flt` ç­‰).

æ­¥éª¤ `scripts/build.mjs`:

1. æ¸…ç† `./build`
2. å¤åˆ¶ `./addon` åˆ° `./build`
3. Esbuild åˆ° `./build/addon/chrome/content/scripts`
4. æ›¿æ¢`__buildVersion__` å’Œ `__buildTime__` åœ¨ `./build/addon`
5. å‹ç¼© `./build/addon` åˆ° `./build/*.xpi`

### å…³äº Zotero API(About Zotero API)

Zotero æ–‡æ¡£å·²è¿‡æ—¶ä¸”ä¸å®Œæ•´ï¼Œgit clone https://github.com/zotero/zotero å¹¶å…¨å±€æœç´¢å…³é”®å­—.

> â­[zotero-types](https://github.com/windingwind/zotero-types) æä¾›äº†æœ€å¸¸ç”¨çš„ Zotero APIï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹å®ƒè¢«åŒ…å«åœ¨æ­¤æ¨¡æ¿ä¸­. ä½ çš„ IDE å°†ä¸ºå¤§å¤šæ•°çš„ API æä¾›æé†’.

çŒœä½ éœ€è¦ï¼šæŸ¥æ‰¾æ‰€éœ€ APIçš„æŠ€å·§

åœ¨ `.xhtml`/`.flt` æ–‡ä»¶ä¸­æœç´¢ UI æ ‡ç­¾ï¼Œç„¶ååœ¨ locale æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é”®. ï¼Œç„¶ååœ¨ `.js`/`.jsx` æ–‡ä»¶ä¸­æœç´¢æ­¤é”®.

### ç›®å½•ç»“æ„(Directory Structure)

æœ¬éƒ¨åˆ†å±•ç¤ºäº†æ¨¡æ¿çš„ç›®å½•ç»“æ„.

- æ‰€æœ‰çš„ `.js/.ts` ä»£ç éƒ½åœ¨ `./src`;
- æ’ä»¶é…ç½®æ–‡ä»¶ï¼š`./addon/manifest.json`;
- UI æ–‡ä»¶: `./addon/chrome/content/*.xhtml`.
- åŒºåŸŸè®¾ç½®æ–‡ä»¶: `./addon/locale/**/*.flt`;
- é¦–é€‰é¡¹æ–‡ä»¶: `./addon/prefs.js`;
  > ä¸è¦åœ¨ `prefs.js` ä¸­æ¢è¡Œ

```shell
.
|-- .eslintrc.json            # eslint conf
|-- .gitattributes            # git conf
|-- .github/                  # github conf
|-- .gitignore                # git conf
|-- .prettierrc               # prettier conf
|-- .release-it.json          # release-it conf
|-- .vscode                   # vs code conf
|   |-- extensions.json
|   |-- launch.json
|   |-- setting.json
|   `-- toolkit.code-snippets
|-- package-lock.json         # npm conf
|-- package.json              # npm conf
|-- LICENSE
|-- README.md
|-- addon
|   |-- bootstrap.js               # addon load/unload script, like a main.c
|   |-- chrome
|   |   `-- content
|   |       |-- icons/
|   |       |-- preferences.xhtml  # preference panel
|   |       `-- zoteroPane.css
|   |-- locale                     # locale
|   |   |-- en-US
|   |   |   |-- addon.ftl
|   |   |   `-- preferences.ftl
|   |   `-- zh-CN
|   |       |-- addon.ftl
|   |       `-- preferences.ftl
|   |-- manifest.json              # addon config
|   `-- prefs.js
|-- build/                         # build dir
|-- scripts                        # scripts for dev
|   |-- build.mjs                  # esbuild and replace
|   |-- reload.mjs
|   |-- start.mjs
|   |-- stop.mjs
|   `-- zotero-cmd-default.json
|-- src                           # source code
|   |-- addon.ts                  # base class
|   |-- hooks.ts                  # lifecycle hooks
|   |-- index.ts                  # main entry
|   |-- modules                   # sub modules
|   |   |-- examples.ts
|   |   `-- preferenceScript.ts
|   `-- utils                     # utilities
|       |-- locale.ts
|       |-- prefs.ts
|       |-- wait.ts
|       `-- window.ts
|-- tsconfig.json                 # https://code.visualstudio.com/docs/languages/jsconfig
|-- typings                       # ts typings
|   `-- global.d.ts
|-- update-template.json          # template of `update.json`
`-- update.json
```

## Disclaimer å…è´£å£°æ˜

åœ¨ AGPL ä¸‹ä½¿ç”¨æ­¤ä»£ç . ä¸æä¾›ä»»ä½•ä¿è¯. éµå®ˆä½ æ‰€åœ¨åœ°åŒºçš„æ³•å¾‹ï¼

å¦‚æœä½ æƒ³æ›´æ”¹è®¸å¯ï¼Œè¯·é€šè¿‡ <wyzlshx@foxmail.com> ä¸æˆ‘è”ç³».
